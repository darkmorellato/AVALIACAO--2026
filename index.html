<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novo Painel de Vendas </title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Chart.js e plugin para data labels -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        /* =======================================================
           Variáveis e Configurações Globais - Tema
           ======================================================= */
        :root {
            --sidebar-bg: #1f2937;
            --sidebar-active: #4f46e5;
            --sidebar-text: #e5e7eb;
            --main-bg: #f3f4f6;
            --card-bg: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --chart-color-positive: #12b950;
            --chart-color-negative: #ef4444;
            --chart-color-low: #ef4444;
            --chart-color-medium: #eccd31;
            --chart-color-good: #3b82f6;
            --chart-color-great: #22c55e;
            --progress-bar-bg: #e5e7eb;
            --progress-bar-low: #ef4444;
            --progress-bar-medium: #fde047;
            --progress-bar-good: #3b82f6;
            --progress-bar-great: #22c55e;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--main-bg);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
        }

        /* =======================================================
           Layout Principal
           ======================================================= */
        .dashboard-layout {
            display: grid;
            /* Apenas uma coluna para o conteúdo principal */
            grid-template-columns: 1fr;
            width: 100%;
        }

        /* =======================================================
           Conteúdo Principal
           ======================================================= */
        .main-content {
            flex-grow: 1;
            padding: 32px;
        }

        .main-header h1 {
            font-size: 2em;
            font-weight: 700;
            margin: 0;
        }
        
        /* Controles de filtro de data */
        .date-filter {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .date-filter button {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 1rem;
            box-shadow: var(--shadow);
        }
        
        .date-filter button:hover {
            background-color: #f9fafb;
        }

        .date-filter button.active {
            background-color: var(--sidebar-active);
            color: #ffffff;
            border-color: var(--sidebar-active);
            transform: scale(1.05);
        }

        .card-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .metric-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .metric-card .icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(79, 70, 229, 0.1);
            color: var(--sidebar-active);
            font-size: 24px;
        }
        
        .metric-card .value {
            font-size: 2em;
            font-weight: 700;
        }

        .metric-card .label {
            color: var(--text-secondary);
            font-weight: 400;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 32px; /* Adicionado para espaçamento */
        }

        /* Estilo específico para o card de cabeçalho */
        .header-card {
            background: linear-gradient(135deg, #4f46e5, #3b82f6); /* Gradiente de azul */
            color: #ffffff; /* Cor da fonte branca */
            text-align: center; /* Centraliza o texto */
            padding: 24px;
            border: none;
            margin-bottom: 24px;
        }
        
        /* Ajusta o h1 dentro do novo card de cabeçalho */
        .header-card h1 {
            color: #ffffff; /* Garante que a cor do texto do h1 seja branca */
            margin: 0;
            font-size: 1.8em;
        }
        
        .period-label {
            /* Garante que o texto dinâmico herde o estilo do h1 */
            font-weight: 700;
        }

        .card h2 {
            font-size: 1.25em;
            font-weight: 600;
            margin: 0 0 20px;
        }

        .chart-container {
            height: 400px;
            position: relative;
        }
        
        .table-card {
            margin-top: 20px;
        }

        /* =======================================================
           Tabela Estilizada
           ======================================================= */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        thead th {
            text-transform: uppercase;
            font-weight: 600;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        /* Classe para centralizar o texto */
        .text-center {
            text-align: center;
        }

        .store-logo {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            object-fit: contain;
            margin-right: 8px;
            vertical-align: middle;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }

        .store-name {
            font-weight: 600;
            vertical-align: middle;
        }

        /* Estilos para a barra de progresso na tabela */
        .progress-cell {
            /* Largura fixa para a célula do progresso */
            width: 150px; 
        }

        .progress-container {
            width: 100%;
            height: 20px;
            background-color: var(--progress-bar-bg);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease-in-out;
            /* Não precisamos mais de flexbox aqui, pois não há texto dentro da barra */
        }
    </style>
</head>
<body>

<div class="dashboard-layout">
    <main class="main-content">
        <!-- O cabeçalho agora está dentro de um 'card' para seguir o padrão visual -->
        <div class="card header-card">
            <!-- Título restaurado para incluir "Análise Detalhada —" conforme o original -->
            <h1>Avaliações de Vendas <br> Análise Detalhada — <span id="period-display" class="period-label">Janeiro 2026</span></h1>
        </div>

        <!-- Seletor de Período -->
        <div class="date-filter">
            <button onclick="switchPeriod('2025-12')" id="btn-2025-12">Dezembro 2025</button>
            <button onclick="switchPeriod('2026-01')" id="btn-2026-01" class="active">Janeiro 2026</button>
        </div>

        <section class="card-metrics">
            <!-- Card de Avaliações Anteriores -->
            <div class="metric-card">
                <div class="icon"><i class="fa-solid fa-history" style="color: #53524c;"></i></div>
                <div>
                    <div class="value" id="total-prev-reviews"></div>
                    <div class="label">Avaliações Anteriores</div>
                </div>
            </div>
            <!-- Card de Avaliações Recentes -->
            <div class="metric-card">
                <div class="icon"><i class="fa-solid fa-star" style="color: #f5da55;"></i></div>
                <div>
                    <div class="value" id="total-reviews"></div>
                    <div class="label">Avaliações Recentes</div>
                </div>
            </div>
            <div class="metric-card">
                <div class="icon"><i class="fa-solid fa-chart-line" style="color: #2ea7df;"></i></div>
                <div>
                    <div class="value" id="total-sales"></div>
                    <div class="label">Vendas Totais</div>
                </div>
            </div>
            <div class="metric-card">
                <div class="icon"><i class="fa-solid fa-check" style="color: #31c745;"></i></div>
                <div>
                    <div class="value" id="total-evaluated"></div>
                    <div class="label">Vendas Avaliadas</div>
                </div>
            </div>
        </section>

        <div class="content-grid">
            <section class="card table-card">
                <h2>Aproveitamento de Avaliações (%)</h2>
                <div class="chart-container">
                    <canvas id="conversionChart"></canvas>
                </div>
            </section>

            <section class="card">
                <h2>Dados Detalhados</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Loja</th>
                            <th class="text-center">Avaliações Anteriores</th>
                            <th class="text-center">Avaliações Recentes</th>
                            <th class="text-center">Vendas</th>
                            <th class="text-center">Vendas Avaliadas</th>
                            <th class="text-center">Aproveitamento (%)</th>
                            <th>Barra de Progresso</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable"></tbody>
                </table>
            </section>
        </div>
    </main>
</div>

<script>
    // Registra o plugin de data labels globalmente para poder usá-lo nos gráficos
    Chart.register(ChartDataLabels);

    // Banco de Dados completo
    const database = {
        '2025-12': {
            label: 'Dezembro 2025',
            // DADOS VERIFICADOS: Mantidos exatamente como no arquivo original
            data: {
                'DOM PEDRO': { prev: 617, current: 686, sales: 151, evaluated: 69 },
                'KASSOUF':   { prev: 383, current: 404, sales: 46, evaluated: 21 },
                'PREMIUM':   { prev: 385, current: 447, sales: 67, evaluated: 62 },
                'REALME':    { prev: 299, current: 326, sales: 55, evaluated: 27 },
                'XV':        { prev: 193, current: 201, sales: 56, evaluated: 8 }
            }
        },
        '2026-01': {
            label: 'Janeiro 2026',
            data: {
                'DOM PEDRO': { prev: 686, current: 733, sales: 118, evaluated: 47 },
                'KASSOUF':   { prev: 404, current: 445, sales: 66, evaluated: 41 },
                'PREMIUM':   { prev: 447, current: 465, sales: 41, evaluated: 18 },
                'REALME':    { prev: 326, current: 357, sales: 55, evaluated: 31 },
                'XV':        { prev: 201, current: 215, sales: 35, evaluated: 14 }
            }
        }
    };

    // Estado atual
    let currentPeriod = '2026-01'; // Define o padrão inicial para Janeiro 2026
    let conversionChartInstance = null; // Variável para armazenar a instância do gráfico

    // Mapeia os nomes das lojas para imagens (mantido do original)
    const storeLogos = {
        'DOM PEDRO': 'Untitled-dom pedro.png',
        'KASSOUF':   'Untitled-kassouf.png',
        'PREMIUM':   'Untitled-premium.png',
        'REALME':    'Untitled-realme.png',
        'XV':        'Untitled-xv.png'
    };

    const percent = (part, total) => total > 0 ? ((part / total) * 100).toFixed(2) : 0;

    // Função principal para trocar o período
    function switchPeriod(period) {
        if (!database[period]) return;
        currentPeriod = period;

        // Atualiza botões
        document.querySelectorAll('.date-filter button').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`btn-${period}`).classList.add('active');

        // Atualiza Título
        document.getElementById('period-display').textContent = database[period].label;

        // Atualiza componentes
        initDashboard();
    }

    // Função para atualizar os cards de métricas
    function updateMetrics() {
        const storesData = database[currentPeriod].data;
        const totalReviews = Object.values(storesData).reduce((acc, curr) => acc + curr.current, 0);
        const totalPrevReviews = Object.values(storesData).reduce((acc, curr) => acc + curr.prev, 0); 
        const totalSales = Object.values(storesData).reduce((acc, curr) => acc + curr.sales, 0);
        const totalEvaluated = Object.values(storesData).reduce((acc, curr) => acc + curr.evaluated, 0);

        document.getElementById('total-reviews').textContent = totalReviews.toLocaleString('pt-BR');
        document.getElementById('total-prev-reviews').textContent = totalPrevReviews.toLocaleString('pt-BR');
        document.getElementById('total-sales').textContent = totalSales.toLocaleString('pt-BR');
        document.getElementById('total-evaluated').textContent = totalEvaluated.toLocaleString('pt-BR');
    }

    function getThemeColors() {
        const style = getComputedStyle(document.body);
        return {
            positive: style.getPropertyValue('--chart-color-positive'),
            negative: style.getPropertyValue('--chart-color-negative'),
            low: style.getPropertyValue('--chart-color-low'),
            medium: style.getPropertyValue('--chart-color-medium'),
            good: style.getPropertyValue('--chart-color-good'),
            great: style.getPropertyValue('--chart-color-great'),
            gridColor: 'rgba(255, 255, 255, 0.1)',
            tickColor: '#6b7280',
            fontColor: '#1f2937'
        };
    }

    function renderCharts() {
        const storesData = database[currentPeriod].data;
        const lojas = Object.keys(storesData);
        const themeColors = getThemeColors();

        // Dados
        const convData = lojas.map(l => parseFloat(percent(storesData[l].evaluated, storesData[l].sales)));
        
        // Cálculo de escala Y
        const maxConv = Math.max(...convData);
        const newYMax = Math.ceil((maxConv * 1.1) / 10) * 10;
        const yAxisMax = newYMax > 0 ? newYMax : 100;

        // Destroi gráfico anterior se existir
        if (conversionChartInstance) {
            conversionChartInstance.destroy();
        }

        const ctx = document.getElementById('conversionChart');
        
        conversionChartInstance = new Chart(ctx, {
            type: 'bar',
            data: { 
                labels: lojas, 
                datasets: [{
                    label: 'Aproveitamento (%)',
                    data: convData,
                    backgroundColor: convData.map(v => 
                        v <= 30 ? themeColors.low : 
                        v <= 50 ? themeColors.medium : 
                        v <= 75 ? themeColors.good : themeColors.great
                    ),
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 1000,
                    easing: 'easeOutQuart'
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: c => `${c.dataset.label}: ${c.parsed.y}%`
                        }
                    },
                    datalabels: {
                        color: '#ffffff',
                        anchor: 'center',
                        align: 'center',
                        font: { weight: 'bold' },
                        formatter: (value) => `${value}%`
                    }
                },
                scales: {
                    y: {
                        max: yAxisMax,
                        title: { display: true, text: 'Aproveitamento (%)', color: themeColors.tickColor },
                        ticks: { color: themeColors.tickColor },
                        grid: { color: themeColors.gridColor }
                    },
                    x: {
                        ticks: { color: themeColors.tickColor },
                        grid: { color: themeColors.gridColor }
                    }
                }
            }
        });
    }

    function createTableRows() {
        const storesData = database[currentPeriod].data;
        const tbody = document.getElementById('dataTable');
        tbody.innerHTML = '';
        const themeColors = getThemeColors();

        const sortedStores = Object.keys(storesData).map(loja => {
            const data = storesData[loja];
            const aproveitamento = percent(data.evaluated, data.sales);
            return {
                loja,
                ...data,
                aproveitamento
            };
        }).sort((a, b) => b.aproveitamento - a.aproveitamento);

        sortedStores.forEach(item => {
            const tr = document.createElement('tr');
            const { loja, prev, current, sales, evaluated, aproveitamento } = item;
            
            let barColor = '';
            if (aproveitamento <= 30) barColor = themeColors.low;
            else if (aproveitamento <= 50) barColor = themeColors.medium;
            else if (aproveitamento <= 75) barColor = themeColors.good;
            else barColor = themeColors.great;

            tr.innerHTML = `
                <td>
                    <img src="${storeLogos[loja]}" alt="Logo ${loja}" class="store-logo">
                    <span class="store-name">${loja}</span>
                </td>
                <td class="text-center">${prev}</td>
                <td class="text-center">${current}</td>
                <td class="text-center">${sales}</td>
                <td class="text-center">${evaluated}</td>
                <td class="text-center" style="color: black; font-weight: 700;">
                    ${aproveitamento}%
                </td>
                <td class="progress-cell">
                    <div class="progress-container">
                        <div class="progress-bar" style="width: ${aproveitamento}%; background-color: ${barColor};"></div>
                    </div>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    function initDashboard() {
        updateMetrics();
        renderCharts();
        createTableRows();
    }

    document.addEventListener('DOMContentLoaded', () => initDashboard());
</script>

</body>
</html>